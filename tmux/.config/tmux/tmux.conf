# ----------------------------------------------------
# Server Options
# ----------------------------------------------------

set -sg escape-time 0
set -s exit-empty on
# set -s exit-unattached on
set -s set-clipboard on

set -g default-terminal "foot"
set -ag terminal-overrides ",*:256:RGB"

setw -g mode-keys vi

# ----------------------------------------------------
# SESSION OPTIONS
# ----------------------------------------------------

set -g base-index 1
set -g mouse on
set -g renumber-windows off

# ----------------------------------------------------
# Status Bar
# ----------------------------------------------------

# Colors (Catppuccin Mocha)
set -g @rosewater "#f5e0dc"
set -g @flamingo "#f2cdcd"
set -g @pink "#f5c2e7"
set -g @mauve "#cba6f7"
set -g @red "#f38ba8"
set -g @maroon "#eba0ac"
set -g @peach "#fab387"
set -g @yellow "#f9e2af"
set -g @green "#a6e3a1"
set -g @teal "#94e2d5"
set -g @sky "#89dceb"
set -g @sapphire "#74c7ec"
set -g @blue "#89b4fa"
set -g @lavender "#b4befe"
set -g @text "#cdd6f4"
set -g @subtext1 "#bac2de"
set -g @subtext0 "#a6adc8"
set -g @overlay2 "#9399b2"
set -g @overlay1 "#7f849c"
set -g @overlay0 "#6c7086"
set -g @surface2 "#585b70"
set -g @surface1 "#45475a"
set -g @surface0 "#313244"
set -g @base "#1e1e2e"
set -g @mantle "#181825"
set -g @crust "#11111b"

# Status line
set -g status-left ""
set -g status-right ""
set -g status-style "bg=#{@base},fg=#{@text}"

set -g window-status-separator ""
set -g window-status-format "#[bg=#{@blue},fg=#{@base},bold] #I #[nobold,bg=#{@surface0},fg=#{@text}] #{b:pane_current_path} • #W "
set -g window-status-current-format "#[bg=#{@peach},fg=#{@base},bold] #I #[nobold,bg=#{@surface0},fg=#{@text}] #{b:pane_current_path} • #W "

# ----------------------------------------------------
# WINDOW OPTIONS
# ----------------------------------------------------

# ----------------------------------------------------
# PANES OPTIONS
# ----------------------------------------------------

set -g pane-base-index 1
set -g pane-border-status off
set -g pane-border-indicators off
# set -g pane-border-format " "
set -g pane-border-style "fg=#{@overlay0}"
set -g pane-active-border-style "fg=#{@peach}"

# ----------------------------------------------------
# Keybidings
# ----------------------------------------------------

# No prefix
unbind C-b
set -g prefix None

# General
bind -n M-q kill-pane
bind -n M-f resize-pane -Z
bind -n M-\; command-prompt
bind -n M-r source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded!"

# Focus / move
bind -n M-h select-pane -L
bind -n M-l select-pane -R
bind -n M-j select-pane -D
bind -n M-k select-pane -U

# Split panes with Alt+- and Alt+=
bind -n M-p display-popup -d "#{pane_current_path}" -w 60% -h 60% -E
bind -n M-= split-window -h -c "#{pane_current_path}"
bind -n M-- split-window -v -c "#{pane_current_path}" -p 20

# Open floatings apps
# bind -n M-y display-popup -d "#{pane_current_path}" -w 70% -h 70% -E "yazi"
bind -n M-g display-popup -d "#{pane_current_path}" -w 80% -h 80% -E "lazygit"

# Resize panes with Alt+Ctrl + h/j/k/l
bind -n M-C-h resize-pane -L 5
bind -n M-C-l resize-pane -R 5
bind -n M-C-k resize-pane -U 5
bind -n M-C-j resize-pane -D 5

# Copy mode
bind -n M-y copy-mode
bind -T copy-mode-vi h send-keys -X cursor-left
bind -T copy-mode-vi j send-keys -X cursor-down
bind -T copy-mode-vi k send-keys -X cursor-up
bind -T copy-mode-vi l send-keys -X cursor-right
bind -T copy-mode-vi x send-keys -X select-line
bind -T copy-mode-vi X send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send-keys -X cancel

# Alt+1..9: switch to window if it exists, else create it at that index
run-shell 'for i in $(seq 1 9); do \
  tmux bind -n M-$i run-shell "tmux select-window -t :$i 2>/dev/null || tmux new-window -t :$i"; \
done'
